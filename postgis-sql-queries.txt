-- This document provides the SQL
-- Copy the contents of this file or drop the POSTGIS.sql file into the pgAdmin query tab.

-- 1. Add the postgis extenstion
CREATE EXTENSION postgis;

-- 2. Verify installation success
SELECT postgis_version();
SELECT postgis_full_version();

-- 3.   SELECT * FROM us_cities limit 20;
        SELECT * FROM us_states limit 20;
        SELECT * FROM us_counties limit 20;

-- 4. Use postgis ST_AsText method -- RETREIEVE FEATURE LOCATIONS
	SELECT id, state, ST_AsText(geom) AS geom FROM us_cities WHERE ST_Equals(geom, '0101000020E61000004481994A1A4258C0703398D06EF64740');

	SELECT id, name, county, lsad,state, ST_AsText(geom) AS geom
	FROM us_counties 
	WHERE ST_Equals(geom, '0106000020AD1000000100000001030000000100000033000000D7A07E17289657C06401C90E244944407C9752978C9557C0ED9DD1562549444072512D228A9557C0A5BDC11726494440AB7823F3C89457C046B58828264944404485EAE6E29357C08670CCB227494440E15B5837DE9257C095EEAEB3214944405B2041F1639257C015FDA19927494440752C5905DD8E57C0A284C142344944407C7901F6D18E57C0EB387EA8343C44406A865451BC8D57C001F9122A383C4440B41CE8A1B68D57C06E179AEB343644401E85EB51B88D57C0FAEAAA402D364440325871AAB58D57C08FC360FE0A334440259012BBB68D57C0B8AD2D3C2F314440B988EFC4AC9257C0B56E83DA6F3144409A417C60C79257C02E8CF4A276314440FE0C6FD6E09257C0E256410C743144406E32AA0CE39457C0CB7F48BF7D3144405F44DB31759757C0950A2AAA7E3144400934D8D4799757C0DB4E5B2382314440E6B0FB8EE19957C0444C89247A314440BCCADAA6789D57C077A04E7974314440B112F3ACA49E57C06DAB59677C314440BDC3EDD0B09E57C0AE9AE7887C31444031056B9C4DA657C0E27327D87F314440D192C7D3F2A657C08F19A88C7F314440349F73B7EBA657C0560C5707403444407A17EFC7EDA657C0556AF6402B364440C79A9141EEA657C0E1D231E719374440E4654D2CF0A657C0B01C2103793C4440F06C8FDE70A857C0A9F7544E7B3C44401900AAB871A857C05DF8C1F9D43D44401059A48977A857C0594A969350484440B844714373A857C0FAA8C29F1C494440A181583673A857C06EF7729F1C494440A432C51C04A657C06090F4691549444051D9B0A6B2A257C098A1F14410494440A703594FADA257C098A1F14410494440473657CD73A257C0286211C30E494440888384285FA257C0286211C30E4944407383A10E2BA257C09FC6BDF90D4944408FA50F5D509F57C0944C4EED0C494440CD1C925A289E57C09E5E29CB1049444061FBC9181F9E57C0B0C91AF5104944401D9B357A7B9D57C02BEE4595144944400D52F014729D57C0E95F92CA144944408251499D809B57C06BD619DF17494440A91807CAD19957C0D654A2C11B49444027F6D21FEC9857C0AB15CDD31D49444062BB7B80EE9657C07D923B6C22494440D7A07E17289657C06401C90E24494440');


	SELECT id, name, ST_AsText(geom) AS geom
	FROM us_states
	WHERE ST_Equals(geom, '0106000020E6100000010000000103000000010000000D0000009CA223B9FC7959C06269E04735004440812381069BD357C06269E047350044406E6B0BCF4BCD57C0E6E95C514AF443408C69A67B9DB857C0683C11C479EA43405BB39597FCC657C0A0DCB6EF51C543409F211CB3ECBE57C07A6CCB80B3B84340CC7B9C69C2B457C0587380608E9A4340A72215C616A757C05DFDD8243F944340FC1A498270A757C00D33349E088042406E6AA0F99C0559C00D33349E0880424003250516C08259C06342CC25557F4240C5573B8A738359C06269E047350044409CA223B9FC7959C06269E04735004440');


-- 5. Use postgis ST_Intersects method -- INTERSECTIONS

	SELECT id, name, ST_AsText(geom)
	FROM us_counties
	WHERE ST_Intersects(geom, ST_GeomFromText(ST_AsText('0106000020AD1000000100000001030000000100000020000000149F244EB6C259C065F8C2A771974140664B5645B8C259C0F0A1444B1E9B414088855AD3BCC259C0E6CAA0DAE09E4140971DE21FB6C259C09415C3D501A0414053E4E3F2B0C259C0E99F64A58DB2414027C11BD2A8C259C0B3976DA7ADCF41404F3C670B08B859C0FD4D2844C0CF41408F1CE90C8CB759C0D4282499D5CF4140F0C2D66CE5AF59C052CF8250DECF41400E4DD9E907A859C01C261AA4E0CF414021020EA14AA759C03524EEB1F4CF4140A59F70766B8A59C0ED5F596952D04140F3565D876A8A59C00CB08F4E5DCF4140A306D3307C8A59C01137A79201C0414097A949F0868A59C0C5025FD1ADBF414002469737878A59C0698A00A777BF4140A7954220978A59C0649291B3B0B34140E884D041978A59C00403081F4AB04140BB9C1210938A59C0EE9579ABAEAF414024B726DD968A59C05D6919A9F7AC41404C1C7920B28A59C026DE019EB49A4140D20149D8B78A59C02446CF2D7497414084D6C397898F59C0BC934F8F6D974140C1C93670079059C06E30D46185974140F33CB83B6B9159C0A92EE06586974140724D81CCCE9259C08126C286A797414038312427139559C08313D1AFAD974140A3224E27D99959C051DCF126BF974140145CACA8C1A259C0BCE9961DE2974140B2834A5CC7A359C00262122EE4974140D7A3703D0AA559C04E97C5C4E6974140149F244EB6C259C065F8C2A771974140') ,4269));


	
-- 6. Use postgis ST_Area method -- CALCULATE AREAS
	
	SELECT id, name, state, ST_Area(geom) AS area
	FROM us_counties
	WHERE ST_Equals(geom, '0106000020AD10000001000000010300000001000000750000001089D1BDE05855C035A045A2DEF44040AB69786B605855C07D1F641BCFEF40400F20B9FE485855C04195A39CE2EE40403FAA61BF275855C0616BB6F292ED404038E477FB165855C0B2E29749E2EC40409E16AB86555755C02AC594C8EBE440403E90BC73285755C06EDA8CD310E3404026E0D748125755C0CD599F724CE240409961A3ACDF5655C0A54C6A6803E04040021DCA73BC5655C0A52DDA969FDE40404932DFFC045655C0B5DCFA3362D74040B8491E27EF5555C097B7729F85D64040E3805503B95455C0186D488B48CA404058E432882E5455C0F8109496D1C44040EB1B98DC285455C0F3FE3F4E98C4404065C74C65265455C0F2ED624879C44040F23D23111A5455C011E0F42EDEC3404082FE428F185455C08F183DB7D0C340402028B7ED7B5355C07EE19524CFBD40401E51A1BAB95355C05EB87361A4BD40406E1283C0CA5355C0683EE76ED7BD404022C50089265455C03B376DC669BE4040B32781CD395455C0A75B76887FBE4040FB20CB82895455C087DA368C82BE404033FAD170CA5455C044BDE0D39CBE4040C9FE791A305555C067F0F78BD9BE404004392861A65555C065AA605452BF4040395CAB3DEC5555C0B58B69A67BBF4040D828EB37135655C02E1D739EB1BF404005172B6A305655C0583A1F9E25C040404F3E3DB6655655C0B01D8CD827C0404011DE1E84805655C0728A8EE4F2BF40407CEE04FBAF5655C00D8B51D7DABF4040B056ED9A905655C08B506C054DBF4040F71C588E905655C061A7583508BF4040CE31207BBD5655C090F7AA9509BF4040D40E7F4DD65F55C08AE8D7D64FBF4040EC4CA1F31A6055C0CEA78E554ABF404033F9669B1B6155C0268BFB8F4CBF40408009DCBA9B6155C051D7DAFB54BF4040904946CEC26155C0842BA0504FBF4040041901158E6255C0647616BD53BF404078EC67B1146455C07CEF6FD05EBF404098F8A3A8336455C00CE4D9E55BBF404019709692E56755C08331225168BF404017D4B7CCE96755C02429E96168BF40402F12DA722E6855C06D8E739B70BF4040236420CF2E6955C0DAC9E02879BF40402DCF83BBB36A55C0EB1D6E8786BF4040B9FDF2C98A6B55C080B8AB5791BF404016F9F5436C6F55C03F8EE6C8CABF40406D1E87C1FC7055C0DC813AE5D1BF40407FD767CEFA7055C005508C2C99BF404071732A19007155C021AF0793E2BD40408F8CD5E6FF7155C095438B6CE7BD4040177C9A93177255C02A8D98D9E7BD4040D09B8A54187255C085B4C6A013BC40408FFE976BD17855C0006E162F16BC4040849ECDAACF7855C0C1E3DBBB06BD40405932C7F2AE7755C0CD91955F06BD4040AC8905BEA27755C02EC896E5EBBE40401C5BCF108E7655C027A3CA30EEBE40408672A25D857655C0219221C7D6BF404062F71DC3637655C0B21188D7F5BF404024F0879FFF7255C0662FDB4E5BC5404066F6798CF27255C0C8B08A3732C740405B971AA19F6F55C0C58F31772DC7404010902FA1826F55C0722F302B14CB4040A641D13C806F55C06DC493DDCCCC40407570B037316F55C0BE310400C7CC404058198D7C5E6E55C0E21E4B1FBACC4040C68844A1656E55C007E9297288CE40402AC6F99B506E55C0C72DE6E786CE404006F01648506E55C0F6B182DF86CE4040A0A52BD8466E55C05B77F35487CE4040A46FD234286C55C0483657CD73CE4040556AF6402B6C55C070B1A206D3CE4040BBB4E1B0346C55C075C8CD7003D04040B5F7A92A346C55C0EFE4D3635BD0404087C1FC15326B55C08124ECDB49D04040F29881CAF86955C0E194B9F946D040403BFBCA83F46955C0E8D84125AED14040174339D1AE6955C0C1E10511A9D14040355CE49EAE6955C0200C3CF71ED2404016139B8F6B6955C0C1374D9F1DD240400BCD751A696955C0BF47FDF50AD34040643A747ADE6855C08FA67A32FFD24040BD6BD097DE6855C0E8F7FD9B17D34040B60F79CBD56855C055DCB8C5FCE240406D73637AC26755C0E198654F02E3404074CC79C6BE6755C0D0D2156C23E44040761A69A9BC6755C02A8A5759DBE4404096C9703C9F6655C05721E527D5E44040F6D1A92B9F6655C087DF4DB7ECE44040D9EC48F59D6655C027124C35B3E6404094BC3AC7806555C07FA4880CABE640408925E5EE736555C02384471B47EC40404F5AB8ACC26855C01F9DBAF259EC40409A5B21ACC66855C0C09481035AEC404036CAFACDC46855C0310917F208F0404006465ED6C46855C04F90D8EE1EF04040B01F6283856655C020B58993FBEF404062821ABE856655C034D93F4F03F0404080B56AD7846655C0D9CEF753E3F14040B4A9BA47366655C09813B4C9E1F140405BED612F146255C0249694BBCFF14040B4E73235096255C0BED7101C97F340409273620FED6155C0E259828C80F84040F92CCF83BB5F55C02BF9D85DA0F840406344A2D0B25F55C0919BE1067CFA4040DA5207793D5B55C0F981AB3C81FA4040E29178793A5B55C07008556AF6FA4040E1D231E7195A55C07D1EA33CF3FA4040EEE87FB9165A55C0105663096BFB4040D3DB9F8B865955C006103E9468FB4040D42711420E5955C049A3942AAAF640401089D1BDE05855C035A045A2DEF44040');


	SELECT id, name, ST_Area(geom) AS area
	FROM us_counties
	WHERE ST_Equals(geom, '0106000020AD10000001000000010300000001000000E6000000E93970ED4D9655C01179CA028DFE3E40F0DD432C6A9655C0396316CF8DFE3E4037C5E3A25A9755C0FB57569A94FE3E403659A31EA29755C0CB9F6F0B96FE3E405778978BF89755C0E9B81AD995FE3E4010ACAA97DF9855C0F84D61A582FE3E40E945ED7E159955C05299620E82FE3E4082700514EA9955C01A9FC9FE79FE3E401057CEDE199D55C0230F441669FE3E40AB083719559D55C0164A26A776FE3E40A7E8482EFF9F55C003CFBD874BFE3E40B891B245D2A055C003098A1F63FE3E40A67C08AA46A155C05FEAE74D45FE3E409F65941FB8A255C07CBBAA8188FE3E40E658DE550FA455C01D3A3DEFC6FE3E40B7EA3A5453A455C08CF4A276BFFE3E40E662B7202DA855C01F55971CA8FE3E4072512D228AAA55C093C2BCC799FE3E4064CA87A06AAB55C075A911FA99FE3E4001C3F9510DAC55C0520214DA9DFE3E409CA5643909AC55C05F251FBB0B003F40E1B19FC552AC55C06954E0641B003F4054008C67D0AC55C06954E0641B003F4056ED9A90D6AC55C0529B38B9DF193F4049F1F109D9AC55C04580D3BB781F3F40ABAFAE0AD4AC55C05968E7340B203F408FFE976BD1AC55C038BC202235313F40054CE0D6DDAC55C037A5BC56424B3F40D6C743DFDDAC55C0FF9254A6984B3F40A50F5D50DFAC55C0A78E554ACF503F40CFBC1C76DFAC55C02B323A2009533F4000E0D8B3E7AC55C0484DBB9866563F40C556D0B4C4AC55C0925852EE3E573F405E0F26C5C7AC55C028603B18B1573F40143B1A87FAAC55C0AB764D486B583F40512D228AC9AC55C05DC0CB0C1B593F40FB743C66A0AC55C0677BF486FB583F402F2E55698BAC55C02043C70E2A593F40AC730CC85EAC55C066F6798CF2583F40A11342075DAC55C06F47382D78593F40880FECF82FAC55C04640852348593F40C51EDAC70AAC55C096C9703C9F593F40E1CFF0660DAC55C089CF9D60FF593F407CD0B359F5AB55C06919A9F7545A3F40A9F3A8F8BFAB55C0F9D9C875535A3F40E5400FB56DAB55C0463F1A4E995B3F400B0A83328DAB55C02FBFD364C65B3F4018CFA0A17FAB55C0C64B3789415C3F4070ECD97399AB55C03DD2E0B6B65C3F40EACC3D247CAB55C0478D0931975C3F408D40BCAE5FAB55C0ADDC0BCC0A5D3F4089B48D3F51AB55C0EC134031B25C3F408D614ED026AB55C05298F738D35C3F40D2C6116BF1AA55C0D4298F6E845D3F40EF1AF4A5B7AA55C022C495B3775E3F402AFF5A5EB9AA55C0DBD9571EA45F3F4033FAD170CAAA55C0B01D8CD827603F40C2F7FE06EDAA55C0CB83F41439603F40BB61DBA2CCAA55C0BE0E9C33A2603F404D469561DCAA55C04C158C4AEA603F403621AD31E8AA55C02EE23B31EB613F409F8F32E202AB55C0732B84D558623F40C171193735AB55C020B3B3E89D623F40AC50A4FB39AB55C00322C495B3633F405698BED710AB55C084656CE866633F4026C632FD12AB55C0B9FC87F4DB633F40B7B41A12F7AA55C04603780B24643F40FDF675E09CAA55C005A568E55E643F40B95164ADA1AA55C02A38BC2022653F402D7B12D89CAA55C0D1915CFE43663F4078D1579066AA55C02A1C412AC5663F404C512E8D5FAA55C0EAE40CC51D673F40BE9D44847FAA55C0776682E15C673F401616DC0F78AA55C01A33897AC1673F40A7785C548BAA55C07D78962023683F40E770ADF6B0AA55C05B3D27BD6F683F40D1B01875ADAA55C0C808A87004693F408350DEC7D1AA55C0B69A75C6F7693F40BBB20B06D7AA55C04162BB7B806A3F40406B7EFCA5AA55C035221807976A3F40B377465B95AA55C0A37213B5346B3F4054A9D903ADAA55C02FBFD364C66B3F404B9352D0EDAA55C0E13D0796236C3F40793A579412AB55C0A339B2F2CB6C3F4050C422861DAB55C0B4C5353E936D3F40ACC8E88024AB55C05436ACA92C6E3F404DD7135D17AB55C0F3C308E1D16E3F403D635FB2F1AA55C097C5C4E6E36E3F4028ED0DBE30AB55C001D71533C26F3F4045D3D9C9E0AC55C0BD175FB4C76F3F40982D5915E1AC55C0B0A888D349763F403198BF42E6AC55C0B9DE365321863F40C3D155BABBAC55C0359886E123863F402A89EC832CAC55C0E52494BE10863F40C70BE9F010AC55C0F0D8CF6229863F4041D47D0052AB55C0739A05DA1D863F40EB55647440AB55C09E78CE1610863F40287FF78E1AA955C0902E36AD14863F4058350873BBA155C01E1840F850863F40A3E5400FB5A155C04BC631923D863F406D57E88365A055C03B4ED1915C863F403C2F151BF39F55C03193A8177C863F4009185DDE1C9F55C0E97E4E417E863F401E1494A2959A55C07CB1F7E28B863F402F17F19D989955C04ECE50DCF1863F4073B9C150879955C0DCB5847CD0773F40F27684D3829955C0AA24B20FB2743F4081035ABA829955C00B3ECDC98B743F40E7FC14C7819955C0989F1B9AB2733F406C205D6C5A9955C0AA0B789961733F40155454FD4A9955C04276DEC666733F405930F147519955C01822A7AFE7733F402A7288B8399955C0929048DBF8733F40D50451F7019955C054C6BFCFB8743F40799274CDE49855C091B75CFDD8743F40E0F3C308E19855C047C5FF1D51753F407FFB3A70CE9855C050A912656F753F404B70EA03C99855C00C022B8716753F40D2FBC6D79E9855C0B6B9313D61753F40E7A7380EBC9855C05C397B67B4753F402F682101A39855C0A86DC32808763F402096CD1C929855C074B0FECF61763F40713B342C469855C05186AA984A773F406C0377A04E9855C0BCAFCA85CA773F40EE59D768399855C08102EFE4D3773F40389F3A56299855C0C6D9740470773F40CEF9298E039855C04468041BD7773F403A72A433309855C02B11A8FE41783F40C6A69542209855C053B0C6D974783F4063CE33F6259855C06471FF91E9783F406C21C841099855C01AF5108DEE783F404374081C099855C09CD843FB58793F400DA837A3E69755C0DC5F3DEE5B793F4045D61A4AED9755C0A415DF50F8783F405D6DC5FEB29755C09679ABAE43793F4058E1968FA49755C03E03EACDA8793F4053AC1A84B99755C082531F48DE793F402D5BEB8B849755C03387A4164A7A3F40BE839F38809755C0CEBF5DF6EB7A3F407E71A94A5B9755C06C3EAE0D157B3F4052EE3EC7479755C04F560C57077C3F40956247E3509755C0629CBF09857C3F4001F9122A389755C047FC8A355C7C3F40D862B7CF2A9755C031755776C17C3F40C2F7FE06ED9655C039B709F7CA7C3F40404D2D5BEB9655C08638D6C56D7C3F40D3D7F335CB9655C074E95F92CA7C3F4058E1968FA49655C0EE022505167C3F40DE736039429655C0832EE1D05B7C3F40BD1C76DF319655C07B4ACE893D7C3F40A9DBD9571E9655C0D80C7041B67C3F406F826F9A3E9655C09750C1E1057D3F406536C824239655C0FE243E77827D3F402C0C91D3D79555C09430D3F6AF7C3F40849B8C2AC39555C010CD3CB9A67C3F40F71F990E9D9555C04C4F58E2017D3F40CCCD37A27B9555C0C536A968AC7D3F407976F9D6879555C010ACAA97DF7D3F402A1A6B7F679555C07AE1CE85917E3F4087156EF9489555C03866D993C07E3F40BB97FBE4289555C0EF1AF4A5B77F3F40861C5BCF109555C0F9A067B3EA7F3F40B003E78C289555C003E621533E803F40276552431B9555C004FC1A4982803F408597E0D4079555C09DF2E84658803F401DAED51EF69455C0C4E8B985AE803F4010786000E19455C07A6CCB80B3803F40567C43E1B39455C0FC17080264803F401D2098A3C79455C0648EE55DF5803F40CB2A6C06B89455C00C59DDEA39813F4037A45181939455C0438D429259813F407C5D86FF749455C0DF12807F4A813F40930035B56C9455C0F0BDBF417B813F4039ECBE63789455C07A336ABE4A823F40D8F335CB659455C0BDFE243E77823F4029E96168759455C026FA7C9411833F40DBDD03745F9455C05A0EF450DB823F409EB29AAE279455C006B8205B96833F40A0FD4811199455C02BF697DD93833F40847D3B89089455C0DC291DACFF833F402B2FF99FFC9355C0CA501553E9833F408D96033DD49355C01DAA29C93A843F40CF11F92EA59355C06E66F4A3E1843F402CF015DD7A9355C0EA93DC6113853F407686A92D759355C0CAA31B6151853F40F7544E7B4A9355C04B546F0D6C853F400C906802459355C0554E7B4ACE853F40EF535568209355C0CAF8F71917863F40C58CF0F6209355C0BB0853944B873F4079CA6ABA9E9255C075C4211B48873F4035B401D8809255C0E7887C9752873F40E5B33C0FEE9155C0E49B6D6E4C873F40E5284014CC9155C04C88B9A46A833F401D1D5723BB9155C0BA675DA3E5743F406D3997E2AA9155C041EDB776A2743F40DA71C3EFA69055C09143C4CDA9743F40DEE68D93C29055C0AE0AD462F0703F4049D576137C8D55C0EF5014E813713F40B28174B1698C55C0A3E2FF8EA8703F400F45813E918C55C05FB4C70BE96C3F408E0244C18C8C55C0A0FA07910C693F40DE3829CC7B8C55C04CBF44BC755A3F40FC51D4997B8C55C0AAEB504D495A3F40A5BC5642778C55C07DE6AC4F39563F406BF294D5748C55C07747C66AF3533F408FC536A9688C55C0D190F12895483F406211C30E638C55C0BAA0BE654E433F40ED48F59D5F8C55C0187959130B403F40C0B167CF658C55C04609FA0B3D3E3F40779D0DF9678C55C0B48F15FC36383F40C119FCFD628C55C0DD21C50089363F40DB148F8B6A8C55C0FD9DEDD11B363F40E52329E9618C55C0B5DD04DF34313F40B85510035D8C55C0552E54FEB5303F4082C64CA25E8C55C0F60A0BEE07203F402BFA43334F8C55C0B9C4910722173F4047A81952458C55C02B4B749659103F40F3E2C4573B8C55C025C9737D1F0A3F401EDB32E02C8C55C0FEEC478AC8003F40AB2006BAF68B55C02D3D9AEAC9003F40F451465C008C55C0001DE6CB0B003F405432ECDBFB8B55C07A0BF4FF79FE3E407F9F71E1408F55C09F1F46088FFE3E40F947DFA4699055C00F0874266DFE3E40D75CA53B5B9155C0A65B9D876BFE3E40F120D60D809255C000DECD9069FE3E40D55DD905839255C088D4B48B69FE3E40839F38807E9355C08C463EAF78FE3E4062699FF3609555C0981FC45086FE3E40E93970ED4D9655C01179CA028DFE3E40');


-- 7. Create table indexes for query optimization -- QUERY OPTIMIZATION -> index

	CREATE INDEX us_cities_geom_idx
	ON us_cities
	USING GIST(geom);

	CREATE INDEX us_counties_geom_idx
	ON us_counties
	USING GIST(geom);

	CREATE INDEX us_states_geom_idx
	ON us_states
	USING GIST(geom);

	DROP INDEX us_cities_geom_idx;

-- 8. Table cleanup -- VACUUM TABLES
 
	VACUUM ANALYZE us_cities;
	VACUUM ANALYZE us_states;
	VACUUM ANALYZE us_counties;

-- 9. Explain queries -- QUERY ANALYSIS

	EXPLAIN SELECT * FROM us_cities ORDER BY id DESC LIMIT 10;

	EXPLAIN SELECT * FROM us_states ORDER BY id DESC LIMIT 10;

	EXPLAIN SELECT * FROM us_counties ORDER BY id DESC LIMIT 10;

--10 Retrieve Locations of county "Geneva"

select geo_id,name,st_astext (geom) as location
from us_counties where (name='Geneva');
